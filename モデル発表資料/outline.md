## 機能モデル

### 戦略

ダブルループNEO(以下ダブルループと記載する)を攻略するために、コースの形状と走行方法に基づいて走行区間を9つのシーンに分割した。9つのシーンの経路と概要を図1.1、表1.1に示す。各シーンの終了条件にはダブルループに存在する青色マーカーの検出を用いる。

### 要求分析とリスク分析

基本戦略に必要な機能とリスクを分析しユースケース図（図1.2）とユースケース記述（表1.2）に示した。ループの攻略にはライントレース走行、エッジの切り替え、切り替え契機の検出のための色の検出が必要であると考えた。これらを脅かすミスアクターとしてカラーセンサーでライントレースをする場合カラーセンサーが読み取れる範囲が狭いこと、環境光に差異が生じることを挙げ、それらに対する緩和策を施した。

なお、エッジ切り替え準備のための低速走行を「遅ライントレース」、それ以外の走行を「速ライントレース」と呼称する。

### 処理フロー

表1.2の基本フローについてアクティビティ図で示した。

## 構造モデル

### 構造方針及びパッケージの役割分担

機能実現のため、システムをハードウェアに近い層から競技者に近い層まで4つのレイヤに分割した。また、役割の分類から7つのパッケージを設計した。これらのパッケージとレイヤをパッケージ図（図2.1）に示す。次に、各パッケージの役割をパッケージ図の説明（表2.1）に示す。

### クラス構造

構造方針とパッケージの役割分担をもとにクラス図の設計を行った。設計したクラスをクラス図（図2.2）に示す。なお、ダブルループ攻略に関係しないクラスについては、紙面の都合上省略する。

## 各パッケージの役割

| パッケージ名 | 役割 |
| ----------- | --- |
| シナリオ管理 | 各シナリオの管理を行う。 |
| 判定方法 | シナリオ切り替えの判定を行う。 |
| 走行方法 | 走行体の動作を行う。 |
| 情報 | 取得した値を処理する。 |
| デバイス管理 | 各デバイスの管理を行う。 |
| Spikeデバイス | モータの値を取得、設定する。 |
| カメラデバイス | カメラモジュールからフレームを取得する。 |

### シナリオ管理
各シナリオの管理を行う。

### 判定方法
シナリオ切り替えの判定を行う。

### 走行方法
走行体の制御を行う。

### 情報
取得した値の処理を行う。

### デバイス管理
各デバイスの管理を行う。

### Spikeデバイス
モータの値を取得、設定する。

### カメラデバイス
カメラモジュールからフレームを取得する。


## 振る舞いモデル

### ダブルループ攻略シナリオの振舞い

機能モデル、構造モデルに基づき、シナリオ開始から青サークル検出によるシナリオ終了までのシナリオクラスの振る舞いをステートマシン図に示す（図3.1）。

### シナリオシーケンサーの振る舞い

ダブルループ進入準備シーンを例に、シナリオシーケンサーがシーンを実行する一連の流れをシーケンス図に示す（図3.2 - 図3.5）。なお、ほかのシーンの振舞いは紙面の都合上省略する。

## 工夫点

### 概要

#### カメラを用いた色の検出、ライントレースの検証

今大会から使用される機体であるHackSpi Clioneでは、Raspberry pi カメラモジュール（以下カメラ）が前面に搭載され、よりカメラが使いやすくなった。
そこで、このカメラを用いてより精度の高いライントレースや色の認識を行うため、カメラでの認識と従来のカラーセンサーでの認識を比較する。

### 検証の方法

カラーセンサーとカメラを用いて、青色を検出できる距離を検証する。
ライン上にロボットを設置し、左右に動かしてラインを認識できる横幅を計測する。

（ラインの上に機体を置いた写真）

また、前後方向に青色を認識できる距離を検証するため、ロボットを離れた位置から青色線に近づけ、青色を検出した距離を計測する。

（ラインにロボットを近づけている写真）

### 検証結果

検証した結果は以下のとおりである

（表）

カメラはカラーセンサーと異なり、より広い画角での画像を取得できるため、カラーセンサーよりも早い段階で青色線を検出できることがわかった。
しかし、実際にライントレースや色の認識にカメラを使用した場合、画角の広さのため、わずかに映り込んだ色を誤検知してしまうことが判明した。
そこで、実際に使用する場合は画像の中央付近を注目領域として切り出し、安定性を確保した。
（注目領域切り出しのイメージ）
